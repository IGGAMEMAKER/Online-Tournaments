//
- tournWidth = 4;

-var convert=100;

mixin showTournaments(tournaments)
	div(class="bloc l-bloc bgc-white b-divider" id="hq1")
		div(class="container bloc-sm")
			- for (i=0; i<tournaments.length;i++) {
				if i%tournWidth==0
					- var lineID = i/tournWidth;
					- console.log(lineID);
					div(class="row" id="line"+lineID)
						//+showTournament(tournaments[i] , lineID, "img/CR2.jpg")

						- for (j=0; j < tournWidth; j++) {
							if (tournaments[i+j])
								+showTournament(tournaments[i+j] , lineID)
								//"img/CR2.jpg")
								//+showTournament({buyIn:100, gameNameID:2, Prizes:['Футболка КР7'], goNext:[150, 3]} , 1 , "img/CR2.jpg")
						-}
					br
					br
			- }
						//+showTournament(tournaments[0] , 1 , "img/CR2.jpg")
			

mixin showGame(gameNameID, ID)
	case gameNameID
		when 0
			| Ошибка, сообщите в техподдержку ##{ID}
		when 1
			| Пинг понг ##{ID}
		when 2
			| Викторина ##{ID}
		when 3
			| Battle ##{ID}
		default
			| Ошибка ##{ID}


mixin showPrizes(prizes)
	h2 Tournament prizes
	table(BORDER="1" CELLPADDING="10" CELLSPACING="0" BORDERCOLOR="000000")
		tr
			td Round
			td Prize
		each prize, index in prizes
			if prize
				tr
					td #{index}
					if isNaN(prize)
						//td GIFT#{JSON.stringify(prize)}
						td 
							a(href="GetGift?giftID="+prize.giftID) Show prize
					else
						td #{prize/convert}$
	br

mixin showPrize(prize, specPrize)
	if specPrize
		h3(id="wnrs-"+ID style="height:55px; width:220px" ) #{specPrize}
	else
		if prize
			if isNaN(prize)
				h3(id="wnrs-"+ID style="height:55px; width:220px" ) Приз: #{prize}
			else
				h3(id="wnrs-"+ID style="height:55px; width:220px" ) Приз: #{prize/convert}$

mixin showImage(imageUrl, gameNameID)
	if imageUrl
		img(src=imageUrl width="210" height="150")
	else
		-var url="/img/CR2.jpg";
		case gameNameID
			when 0
				| Ошибка, сообщите в техподдержку ##{ID}
			when 1
				img(src="/img/pp.jpg" width="210" height="150")
			when 2
				img(src="/img/quiz.png" width="210" height="150")
			when 3
				| Battle ##{ID}
			default
				| Ошибка ##{ID}

mixin showButton()
	center
		//p!= JSON.stringify(t)
		a(id="reg" class="btn btn-lg btn-primary" style="width:60%; border-radius:6px; display:none;") Зарегистрироваться
		div(id="unregister" style="display:none;")
			h2 Вы зарегистрированы в турнире. 
			h3 Дождитесь начала игры
			a(id="unReg" class="btn btn-lg btn-danger" style="width:60%; border-radius:6px;") Сняться с турнира
		div(id="auth")
			h2 Авторизуйтесь, чтобы сыграть
			a(id="lgn" href="login" class="btn btn-lg btn-primary" style="width:60%; border-radius:6px; ") Авторизоваться

mixin drawRegButton(buyIn, ID)
	if session && session.login
		a(id="reg"+ID onclick="reg('"+session.login+"',"+ID+")" class="btn btn-lg btn-primary" style="border-radius:6px; ") 
			if buyIn>0
					Играть за #{buyIn/convert}$
			else
					Играть БЕСПЛАТНО
		div(id="unregister"+ID style="display:none;")
			Вы зарегистрированы в турнире. 
			//h3 Дождитесь начала игры
			a(id="unReg"+ID onclick="unReg('"+session.login+"',"+ID+")" class="btn btn-lg btn-danger" style="border-radius:6px;") Сняться с турнира
		

		//a(href="TournamentInfo?tID="+ID class="btn btn-lg btn-primary" style="border-radius:6px; ") 
			if buyIn>0
					Играть за #{buyIn/convert}$
			else
					Играть БЕСПЛАТНО
		//a(href="TournamentInfo?tID="+ID class="btn btn-lg btn-primary" style="width:60%; border-radius:6px; ") Играть
	else
		div(id="auth"+ID)
			h4 Авторизуйтесь, чтобы сыграть
			a(id="lgn"+ID href="login" class="btn btn-lg btn-danger" style="border-radius:6px; ") Авторизоваться

mixin showTournament(t,line, imageUrl)
	if t
		- var ID=t.tournamentID||115;
		- var registered = t.players;
		- var gameNameID = t.gameNameID;
		- var prizes = t.Prizes[0];	
		- var maxPlayers = t.goNext[0];
		- var winnersPlaces = t.goNext[1];
		- var buyIn = t.buyIn || 0;
	
		div(class="col-sm-3")
			center
				h4(class="mg-md text-center" id="gname-"+ID)
					+showGame(t.gameNameID, t.tournamentID)
				// image
				if t.settings && t.settings.special
					+showImage('img/'+ID+'.jpg', t.gameNameID)
				else
					+showImage(imageUrl, t.gameNameID)
				
				// prize
				
				if t.settings && t.settings.special
					+showPrize(prizes, t.settings.specPrizeName)
				else
					+showPrize(prizes)
				h4(class="mg-md")
					//if buyIn>0
						Стоимость: #{buyIn/convert}$
					//else
						Бесплатно!
					//br
					//Призовых мест: #{winnersPlaces}
					br
					div(id="plrs-"+ID)
						Участников : #{registered} из #{maxPlayers}
				+drawRegButton(buyIn, ID)
				

-var red = "#FF0000";
-var green = "#00FF00";
-var blue = "#0000FF";

//include templates/tournaments

html
	head
		title!= 'Турниры'
		include templates/head
		//link(rel="stylesheet" type="text/css" href="/css/bootstrap.min.css")
		script(src="registerUserInTournament.js")
	body
		div(class="page-container")
			include client
			
			div(class="bloc l-bloc bgc-white" id="bloc-1")
				div(class="container")
					div(class="row")
						div(class="col-sm-12")
							h3(class="mg-md text-center") Турниры
			//p!= JSON.stringify(msg)
			+showTournaments(msg)
			include templates/footer
